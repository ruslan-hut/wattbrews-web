<div class="station-detail-container">
  <!-- Header -->
  @if (!translationsLoading()) {
    <div class="page-header">
      <button mat-icon-button (click)="goBack()" class="back-button">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <div class="header-content">
        <h1 class='page-title'>{{ translationService.getReactive('stationDetail.title') }}</h1>
        @if (stationDetail()) {
          <p class="page-subtitle">{{ stationDetail()!.title }}</p>
        }
      </div>
    </div>
  }

  <!-- Loading State -->
  @if (loading() || translationsLoading()) {
    <div class="loading-container">
      <app-loading-spinner></app-loading-spinner>
      @if (!translationsLoading()) {
        <p>{{ translationService.getReactive('stationDetail.loading') }}</p>
      }
    </div>
  }

  <!-- Error State -->
  @if (error() && !loading() && !translationsLoading()) {
    <div class="error-container">
      <app-error-message [message]="error()!"></app-error-message>
      <button mat-raised-button color="primary" (click)="loadStationDetail()">
        <mat-icon>refresh</mat-icon>
        {{ translationService.getReactive('stationDetail.tryAgain') }}
      </button>
    </div>
  }

  <!-- Station Details -->
  @if (stationDetail() && !loading() && !error() && !translationsLoading()) {
    <div class="station-details">
    <!-- Basic Information -->
    <mat-card class="info-card">
      <mat-card-header>
        <div mat-card-avatar class="station-status-icon">
          <mat-icon [class]="getStatusIconClass()">{{ getStatusIcon() }}</mat-icon>
        </div>
        <mat-card-title>{{ stationDetail()!.title }}</mat-card-title>
        <mat-card-subtitle>{{ stationDetail()!.charge_point_id }}</mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <div class="info-grid">
          <div class="info-item">
            <mat-icon class="info-icon">location_on</mat-icon>
            <div class="info-content">
              <span class="info-label">{{ translationService.getReactive('stationDetail.labels.address') }}</span>
              <span class="info-value">{{ stationDetail()!.address }}</span>
            </div>
          </div>
          
          <div class="info-item">
            <mat-icon class="info-icon">business</mat-icon>
            <div class="info-content">
              <span class="info-label">{{ translationService.getReactive('stationDetail.labels.vendor') }}</span>
              <span class="info-value">{{ stationDetail()!.vendor }}</span>
            </div>
          </div>
          
          <div class="info-item">
            <mat-icon class="info-icon">memory</mat-icon>
            <div class="info-content">
              <span class="info-label">{{ translationService.getReactive('stationDetail.labels.model') }}</span>
              <span class="info-value">{{ stationDetail()!.model }}</span>
            </div>
          </div>
          
          <div class="info-item">
            <mat-icon class="info-icon">tag</mat-icon>
            <div class="info-content">
              <span class="info-label">{{ translationService.getReactive('stationDetail.labels.serialNumber') }}</span>
              <span class="info-value">{{ stationDetail()!.serial_number }}</span>
            </div>
          </div>
          
          <div class="info-item">
            <mat-icon class="info-icon">update</mat-icon>
            <div class="info-content">
              <span class="info-label">{{ translationService.getReactive('stationDetail.labels.firmwareVersion') }}</span>
              <span class="info-value">{{ stationDetail()!.firmware_version }}</span>
            </div>
          </div>
          
          <div class="info-item">
            <mat-icon class="info-icon">schedule</mat-icon>
            <div class="info-content">
              <span class="info-label">{{ translationService.getReactive('stationDetail.labels.lastSeen') }}</span>
              <span class="info-value">{{ formatDateTime(stationDetail()!.event_time) }}</span>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Status Information with Map -->
    <mat-card class="status-card">
      <mat-card-header>
        <mat-card-title>{{ translationService.getReactive('stationDetail.statusInformation') }}</mat-card-title>
      </mat-card-header>
      
      <mat-card-content>
        <div class="status-map-container">
          <!-- Status Grid -->
          <div class="status-content">
            <div class="status-grid">
              <div class="status-item">
                <mat-chip [class]="getStatusChipClass(stationDetail()!.status)">
                  {{ stationDetail()!.status }}
                </mat-chip>
                <span class="status-label">{{ translationService.getReactive('stationDetail.labels.currentStatus') }}</span>
              </div>
              
              <div class="status-item">
                <mat-chip [class]="getErrorChipClass(stationDetail()!.error_code)">
                  {{ stationDetail()!.error_code }}
                </mat-chip>
                <span class="status-label">{{ translationService.getReactive('stationDetail.labels.errorCode') }}</span>
              </div>
              
              <div class="status-item">
                <mat-chip [class]="stationDetail()!.is_online ? 'online' : 'offline'">
                  {{ stationDetail()!.is_online ? translationService.getReactive('stationDetail.status.online') : translationService.getReactive('stationDetail.status.offline') }}
                </mat-chip>
                <span class="status-label">{{ translationService.getReactive('stationDetail.labels.connection') }}</span>
              </div>
              
              <div class="status-item">
                <mat-chip [class]="stationDetail()!.is_enabled ? 'enabled' : 'disabled'">
                  {{ stationDetail()!.is_enabled ? translationService.getReactive('stationDetail.status.enabled') : translationService.getReactive('stationDetail.status.disabled') }}
                </mat-chip>
                <span class="status-label">{{ translationService.getReactive('stationDetail.labels.availability') }}</span>
              </div>
            </div>
            
            @if (stationDetail()!.info) {
              <div class="status-info">
                <p><strong>{{ translationService.getReactive('stationDetail.labels.info') }}</strong> {{ stationDetail()!.info }}</p>
              </div>
            }
            
            <div class="status-updated">
              <p><strong>{{ translationService.getReactive('stationDetail.labels.statusUpdated') }}</strong> {{ getTimeAgo(stationDetail()!.event_time) }}</p>
            </div>
          </div>
          
          <!-- Map Section -->
          @if (stationDetail()!.location && stationDetail()!.location.latitude && stationDetail()!.location.longitude) {
            <div class="map-container">
              <app-small-map
                [latitude]="stationDetail()!.location.latitude"
                [longitude]="stationDetail()!.location.longitude"
                [title]="stationDetail()!.title"
                [height]="'100%'"
                [zoom]="15">
              </app-small-map>
            </div>
          }
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Connectors -->
    <mat-card class="connectors-card">
      <mat-card-header>
        <mat-card-title>{{ translationService.getReactive('stationDetail.connectors') }} ({{ stationDetail()!.connectors.length }})</mat-card-title>
      </mat-card-header>
      
      <mat-card-content>
        <div class="connectors-grid">
          @for (connector of stationDetail()!.connectors | sortByConnectorId; track connector.connector_id) {
            <div 
              class="connector-item"
              [class.available]="connector.status === 'Available'"
              [class.occupied]="connector.status === 'Occupied'"
              [class.out-of-order]="connector.status === 'OutOfOrder'">
              
              <div class="connector-header">
                <h4>{{ translationService.getReactive('stationDetail.labels.connector') }} {{ (connector.connector_id_name || connector.connector_id) }}</h4>
                <div class="connector-status-actions">
                  @if (connector.current_transaction_id > 0) {
                    <button 
                      mat-button 
                      class="transaction-id-button"
                      (click)="openTransactionDetails(connector.current_transaction_id, $event)"
                      [matTooltip]="translationService.getReactive('stationDetail.tooltips.viewTransaction')"
                    >
                      <mat-icon>receipt</mat-icon>
                      #{{ connector.current_transaction_id }}
                    </button>
                  }
                  <mat-chip [class]="getConnectorStatusClass(connector.status)">
                    {{ connector.status }}
                  </mat-chip>
                </div>
              </div>
            
            <div class="connector-details">
              <div class="connector-info">
                <span class="connector-label">{{ translationService.getReactive('stationDetail.labels.type') }}</span>
                <span class="connector-value">{{ connector.type }}</span>
              </div>
              
              <div class="connector-info">
                <span class="connector-label">{{ translationService.getReactive('stationDetail.labels.power') }}</span>
                <span class="connector-value">{{ connector.power }} kW</span>
              </div>
              
              <div class="connector-info">
                <span class="connector-label">{{ translationService.getReactive('stationDetail.labels.vendorWithColon') }}</span>
                <span class="connector-value">{{ connector.vendor_id }}</span>
              </div>
              
              <div class="connector-info">
                <span class="connector-label">{{ translationService.getReactive('stationDetail.labels.errorCodeWithColon') }}</span>
                <span class="connector-value">{{ connector.error_code }}</span>
              </div>
            </div>
              
              @if (connector.info) {
                <div class="connector-status-info">
                  <p><strong>{{ translationService.getReactive('stationDetail.labels.info') }}</strong> {{ connector.info }}</p>
                </div>
              }
              
              <div class="connector-time">
                <p><strong>{{ translationService.getReactive('stationDetail.labels.statusTimeWithColon') }}</strong> {{ formatDateTime(connector.status_time) }}</p>
              </div>
            </div>
          }
        </div>
        
        <!-- Start Charge Button -->
        @if (hasAvailableConnectors()) {
          <div class="start-charge-section">
            <button 
              mat-button 
              color="primary" 
              class="start-charge-button"
              (click)="startCharge()">
              <mat-icon>play_arrow</mat-icon>
              {{ translationService.getReactive('stationDetail.actions.startCharge') }}
            </button>
            <p class="start-charge-info">{{ translationService.getReactive('stationDetail.actions.startChargeInfo') }}</p>
          </div>
        }
      </mat-card-content>
    </mat-card>
    </div>
  }
</div>

